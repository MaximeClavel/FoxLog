# üîÑ Guide de migration vers Phase 1

## üìã Vue d'ensemble

Ce guide vous accompagne pour migrer votre extension FoxLog actuelle vers la **Phase 1** qui inclut le parsing avanc√© des logs.

**Dur√©e estim√©e** : 15-30 minutes  
**Difficult√©** : Facile  
**Risque** : Faible (changements non-destructifs)

---

## üéØ Avant de commencer

### Pr√©requis

- ‚úÖ Extension FoxLog fonctionnelle
- ‚úÖ Git install√© (recommand√©)
- ‚úÖ √âditeur de code (VS Code, Sublime, etc.)
- ‚úÖ Chrome ou Edge avec mode d√©veloppeur

### Sauvegarde

**IMPORTANT** : Sauvegardez toujours avant une migration !

```bash
# Option 1: Git
git checkout -b backup-v1.0.3
git add .
git commit -m "Backup version 1.0.3 avant Phase 1"

# Option 2: Copie manuelle
cp -r FoxLog FoxLog-backup-20251020
```

---

## üì¶ √âtape 1 : T√©l√©charger les fichiers

### Fichiers √† cr√©er

1. **log-parser.js** (nouveau)
2. **modal-styles.css** (nouveau)
3. **test-parser.js** (nouveau, optionnel)

### Fichiers √† modifier

1. **content.js** (remplacement)
2. **manifest.json** (ajout de ressources)

### Comparaison avant/apr√®s

| Fichier | Avant | Apr√®s | Action |
|---------|-------|-------|--------|
| `log-parser.js` | ‚ùå N'existe pas | ‚úÖ ~350 lignes | **Cr√©er** |
| `modal-styles.css` | ‚ùå N'existe pas | ‚úÖ ~450 lignes | **Cr√©er** |
| `content.js` | ‚úÖ ~500 lignes | ‚úÖ ~700 lignes | **Remplacer** |
| `manifest.json` | ‚úÖ Version 1.0.3 | ‚úÖ Version 1.0.4 | **Modifier** |
| `styles.css` | ‚úÖ Inchang√© | ‚úÖ Inchang√© | Aucune |
| `background.js` | ‚úÖ Inchang√© | ‚úÖ Inchang√© | Aucune |
| `injected.js` | ‚úÖ Inchang√© | ‚úÖ Inchang√© | Aucune |

---

## üîß √âtape 2 : Cr√©er les nouveaux fichiers

### 2.1 Cr√©er log-parser.js

```bash
# √Ä la racine du projet
touch log-parser.js
```

Copiez le contenu de l'artifact **foxlog_parser** dans ce fichier.

**V√©rification** :
```javascript
// Le fichier doit commencer par :
// ============================================
// FOXLOG - LOG PARSER
// Phase 1: Parser le log brut en structure exploitable
// ============================================
```

### 2.2 Cr√©er modal-styles.css

```bash
touch modal-styles.css
```

Copiez le contenu de l'artifact **modal_styles** dans ce fichier.

**V√©rification** :
```css
/* Le fichier doit commencer par :
/* ============================================
   STYLES POUR LA MODAL PARS√âE - PHASE 1
   ============================================ */
```

### 2.3 Cr√©er test-parser.js (optionnel)

```bash
mkdir -p tests
touch tests/test-parser.js
```

Copiez le contenu de l'artifact **test_parser** dans ce fichier.

---

## ‚úèÔ∏è √âtape 3 : Modifier content.js

### Option A : Remplacement complet (recommand√©)

```bash
# Sauvegarder l'ancien
cp content.js content.js.backup

# Remplacer par le nouveau
# Copiez le contenu de l'artifact content_updated
```

### Option B : Modification manuelle (avanc√©)

Si vous avez des modifications personnalis√©es dans `content.js`, voici les changements √† appliquer :

#### 3.1 Ajouter le chargement du parser

**Avant** (ligne ~20) :
```javascript
if (isSalesforcePage()) {
  injectScript();
}
```

**Apr√®s** :
```javascript
let logParser = null; // ‚úÖ AJOUTER

function loadParser() { // ‚úÖ AJOUTER CETTE FONCTION
  try {
    const script = document.createElement('script');
    script.src = chrome.runtime.getURL('log-parser.js');
    script.onload = function() {
      debugLog('‚úÖ Parser charg√© avec succ√®s');
      logParser = new window.SalesforceLogParser();
      this.remove();
    };
    (document.head || document.documentElement).appendChild(script);
  } catch (error) {
    debugLog('‚ùå Erreur chargement parser:', error);
  }
}

if (isSalesforcePage()) {
  injectScript();
  loadParser(); // ‚úÖ AJOUTER
}
```

#### 3.2 Modifier la structure de cache

**Avant** (ligne ~150) :
```javascript
cachedLogs = logs;
lastFetchTime = Date.now();
```

**Apr√®s** :
```javascript
// ‚úÖ REMPLACER PAR :
const parsedLogs = [];
if (logs && logs.length > 0 && logParser) {
  for (const log of logs) {
    parsedLogs.push({
      metadata: log,
      parsed: null,
      summary: {
        id: log.Id,
        operation: log.Operation,
        status: log.Status,
        duration: log.DurationMilliseconds,
        logLength: log.LogLength
      }
    });
  }
}

cachedLogs = {
  raw: logs,
  parsed: parsedLogs
};
lastFetchTime = Date.now();
```

#### 3.3 Modifier viewLogDetails

**Avant** (ligne ~400) :
```javascript
window.viewLogDetails = async function(logId) {
  // ... code existant
  const logBody = await response.text();
  showLogModal(logBody); // ‚ùå ANCIEN
};
```

**Apr√®s** :
```javascript
window.viewLogDetails = async function(logId) {
  // ... code existant
  const logBody = await response.text();
  
  // ‚úÖ AJOUTER :
  if (logParser && cachedLogs) {
    showLoadingSpinner('Analyse du log...', 'Parsing en cours');
    const logMetadata = cachedLogs.raw.find(l => l.Id === logId);
    const parsedLog = logParser.parse(logBody, logMetadata);
    hideLoadingSpinner();
    showParsedLogModal(parsedLog); // ‚úÖ NOUVEAU
  } else {
    showLogModal(logBody); // Fallback
  }
};
```

#### 3.4 Ajouter les fonctions de rendu

Ajoutez √† la fin de `content.js` (apr√®s la fonction `showLogModal`) :

```javascript
// ‚úÖ AJOUTER CES FONCTIONS :
function showParsedLogModal(parsedLog) { /* ... */ }
function renderSummaryTab(summary, parsedLog) { /* ... */ }
function renderTimelineTab(parsedLog) { /* ... */ }
```

Copiez ces fonctions depuis l'artifact **content_updated**.

---

## üìù √âtape 4 : Modifier manifest.json

### 4.1 Changer la version

**Avant** :
```json
{
  "version": "1.0.3",
```

**Apr√®s** :
```json
{
  "version": "1.0.4",
```

### 4.2 Ajouter modal-styles.css

**Avant** :
```json
"content_scripts": [
  {
    "js": ["content.js"],
    "css": ["styles.css"],
```

**Apr√®s** :
```json
"content_scripts": [
  {
    "js": ["content.js"],
    "css": ["styles.css", "modal-styles.css"],
```

### 4.3 Ajouter log-parser.js aux ressources

**Avant** :
```json
"web_accessible_resources": [
  {
    "resources": [
      "icon16.png",
      "icon48.png",
      "icon128.png",
      "tail128.png",
      "trash.png",
      "refresh.png",
      "injected.js"
    ],
```

**Apr√®s** :
```json
"web_accessible_resources": [
  {
    "resources": [
      "icon16.png",
      "icon48.png",
      "icon128.png",
      "tail128.png",
      "trash.png",
      "refresh.png",
      "injected.js",
      "log-parser.js"
    ],
```

---

## ‚úÖ √âtape 5 : Validation

### 5.1 V√©rifier la structure du projet

```bash
ls -la

# Devrait afficher :
# manifest.json           ‚úÖ
# background.js           ‚úÖ
# content.js              ‚úÖ (modifi√©)
# injected.js             ‚úÖ
# styles.css              ‚úÖ
# modal-styles.css        ‚úÖ (nouveau)
# log-parser.js           ‚úÖ (nouveau)
# icon16.png              ‚úÖ
# icon48.png              ‚úÖ
# icon128.png             ‚úÖ
# tail128.png             ‚úÖ
# trash.png               ‚úÖ
# refresh.png             ‚úÖ
```

### 5.2 V√©rifier manifest.json

```bash
# Valider la syntaxe JSON
cat manifest.json | python -m json.tool > /dev/null && echo "‚úÖ JSON valide" || echo "‚ùå JSON invalide"
```

### 5.3 Compter les lignes de code

```bash
wc -l log-parser.js modal-styles.css content.js

# R√©sultat attendu :
#  350 log-parser.js
#  450 modal-styles.css
#  700 content.js
```

---

## üîÑ √âtape 6 : Recharger l'extension

### 6.1 Dans Chrome/Edge

1. Ouvrez `chrome://extensions/`
2. Activez le **Mode d√©veloppeur** (en haut √† droite)
3. Trouvez **FoxLog**
4. Cliquez sur le bouton **Recharger** (üîÑ)

### 6.2 V√©rifier les erreurs

Si vous voyez des erreurs :
- Cliquez sur "Erreurs" dans la carte de l'extension
- Notez le message d'erreur
- Consultez la section D√©pannage ci-dessous

---

## üß™ √âtape 7 : Tests

### 7.1 Test de chargement

1. Ouvrez une page Salesforce Lightning
2. Ouvrez DevTools (F12)
3. Allez dans l'onglet Console
4. Cherchez ces messages :

```
[FoxLog] === Initialisation de FoxLog ===
[FoxLog] ‚úÖ Script injected.js charg√© avec succ√®s
[FoxLog] ‚úÖ Parser charg√© avec succ√®s
[FoxLog Parser] ‚úÖ Parser charg√© et disponible
```

**Si vous ne voyez pas ces messages** ‚Üí Voir section D√©pannage

### 7.2 Test fonctionnel

1. Cliquez sur le bouton FoxLog (ic√¥ne de renard)
2. Le panel doit s'ouvrir
3. Cliquez sur **D√©tails** d'un log
4. V√©rifiez :
   - ‚úÖ 3 onglets visibles (R√©sum√© / Timeline / Log brut)
   - ‚úÖ R√©sum√© affiche des statistiques
   - ‚úÖ Barres de progression color√©es
   - ‚úÖ Timeline color√©e
   - ‚úÖ Log brut lisible

### 7.3 Test du parser (optionnel)

Dans la console DevTools :

```javascript
// Tester le parser
console.log(window.SalesforceLogParser); // Doit retourner [Function]
console.log(logParser); // Doit retourner une instance

// Ex√©cuter les tests automatis√©s
// Copiez-collez le contenu de tests/test-parser.js
```

---

## üêõ D√©pannage

### Probl√®me : Parser ne se charge pas

**Sympt√¥me** :
```
Erreur: logParser is null
```

**Solution** :
1. V√©rifiez que `log-parser.js` existe
2. V√©rifiez qu'il est dans `web_accessible_resources` du manifest
3. Rechargez l'extension
4. Videz le cache du navigateur (Ctrl+Shift+Del)

### Probl√®me : Modal mal format√©e

**Sympt√¥me** : La modal s'affiche sans styles

**Solution** :
1. V√©rifiez que `modal-styles.css` existe
2. V√©rifiez qu'il est dans `content_scripts.css` du manifest
3. Rechargez la page Salesforce (F5)
4. Inspectez l'√©l√©ment pour voir si les classes CSS existent

### Probl√®me : Erreur JSON dans manifest

**Sympt√¥me** :
```
Could not load manifest: Invalid JSON
```

**Solution** :
```bash
# Valider le JSON
cat manifest.json | python -m json.tool

# Ou utilisez un validateur en ligne
# https://jsonlint.com/
```

Erreurs courantes :
- Virgule en trop √† la fin d'un array
- Guillemets manquants
- Accolades non ferm√©es

### Probl√®me : Extension ne se recharge pas

**Solution** :
1. Supprimez l'extension
2. Rechargez la page `chrome://extensions/`
3. Cliquez sur "Charger l'extension non empaquet√©e"
4. S√©lectionnez le dossier FoxLog

### Probl√®me : Logs ne s'affichent pas

**V√©rifications** :
1. Ouvrez la console ‚Üí Cherchez des erreurs
2. V√©rifiez que vous √™tes sur une page Salesforce
3. V√©rifiez que vous avez des logs r√©cents
4. Essayez de rafra√Æchir (bouton üîÑ dans FoxLog)

---

## üìä Checklist de migration

Cochez au fur et √† mesure :

- [ ] Backup effectu√© (git ou copie)
- [ ] `log-parser.js` cr√©√© et rempli
- [ ] `modal-styles.css` cr√©√© et rempli
- [ ] `content.js` mis √† jour
- [ ] `manifest.json` modifi√© (version + ressources)
- [ ] Extension recharg√©e dans Chrome
- [ ] Aucune erreur dans chrome://extensions/
- [ ] Message de chargement du parser visible
- [ ] Panel FoxLog s'ouvre correctement
- [ ] Modal √† 3 onglets fonctionne
- [ ] Tests automatis√©s passent (optionnel)

**Score** : ___/11

Si vous avez 11/11 ‚úÖ, la migration est **r√©ussie** ! üéâ

---

## üîô Rollback (en cas de probl√®me)

Si quelque chose ne fonctionne pas, vous pouvez revenir en arri√®re :

### Option 1 : Git

```bash
git checkout backup-v1.0.3
```

### Option 2 : Copie manuelle

```bash
# Restaurer la backup
rm -rf FoxLog
cp -r FoxLog-backup-20251020 FoxLog
```

### Option 3 : Fichier par fichier

```bash
# Restaurer content.js
cp content.js.backup content.js

# Supprimer les nouveaux fichiers
rm log-parser.js modal-styles.css

# Restaurer manifest.json
git checkout manifest.json
```

Puis rechargez l'extension.

---

## üìû Support

Si vous rencontrez des probl√®mes :

1. **V√©rifiez les logs** : Console DevTools
2. **Activez le debug** : `CONFIG.DEBUG_MODE = true` dans content.js
3. **Testez le parser** : Ex√©cutez `tests/test-parser.js`
4. **Comparez les fichiers** : Utilisez un outil de diff

---

## üéØ Prochaine √©tape

Une fois la migration valid√©e, vous pouvez :

1. ‚úÖ **Tester** avec diff√©rents types de logs
2. ‚úÖ **Partager** avec des coll√®gues
3. ‚úÖ **Pr√©parer** la Phase 2 (filtrage avanc√©)
4. ‚úÖ **Contribuer** : Remonter bugs et suggestions

---

## üìù Notes de version

### Version 1.0.4 (Phase 1)

**Nouvelles fonctionnalit√©s** :
- ‚úÖ Parser de logs Salesforce complet
- ‚úÖ Modal √† 3 onglets (R√©sum√©, Timeline, Log brut)
- ‚úÖ Extraction automatique des statistiques
- ‚úÖ D√©tection des erreurs et exceptions
- ‚úÖ Visualisation des limites Salesforce
- ‚úÖ Timeline color√©e par type d'√©v√©nement

**Am√©liorations** :
- ‚úÖ Cache structur√© pour meilleures performances
- ‚úÖ Chargement asynchrone du parser
- ‚úÖ Fallback gracieux si parsing √©choue

**Corrections** :
- Aucune (nouvelle fonctionnalit√©)

**Connu** :
- Le parsing n'est pas mis en cache (pr√©vu pour Phase 2)
- Limite de 100 lignes dans la timeline (ajustable)

---

## üîÑ Historique des migrations

| Version | Date | Changements | Difficult√© |
|---------|------|-------------|------------|
| 1.0.0 ‚Üí 1.0.1 | 2024-XX-XX | Correction bugs | ‚≠ê Facile |
| 1.0.1 ‚Üí 1.0.2 | 2024-XX-XX | Am√©lioration UI | ‚≠ê Facile |
| 1.0.2 ‚Üí 1.0.3 | 2024-XX-XX | Ajout refresh auto | ‚≠ê‚≠ê Moyen |
| 1.0.3 ‚Üí 1.0.4 | 2025-10-20 | **Phase 1 Parser** | ‚≠ê‚≠ê Moyen |

---

## üí° Conseils pro

### Optimisation

1. **Ne parsez que si n√©cessaire**
   - Le parsing est fait √† la demande (clic sur "D√©tails")
   - Pas de ralentissement au chargement initial

2. **Utilisez le cache**
   - Les logs bruts sont en cache pendant 30s
   - √âvitez les requ√™tes API inutiles

3. **Profil de performance**
   ```javascript
   // Dans la console
   performance.mark('start');
   const parsed = logParser.parse(bigLog, metadata);
   performance.mark('end');
   performance.measure('parsing', 'start', 'end');
   console.log(performance.getEntriesByName('parsing')[0].duration);
   ```

### Debug

1. **Activer les logs d√©taill√©s**
   ```javascript
   // Dans content.js
   const CONFIG = {
     DEBUG_MODE: true, // ‚úÖ Activer
     // ...
   };
   ```

2. **Inspecter un log pars√©**
   ```javascript
   // Apr√®s avoir cliqu√© sur "D√©tails"
   // Dans la console :
   window.lastParsedLog // Variable globale (si ajout√©e)
   ```

3. **Tester le parser isol√©ment**
   ```javascript
   const parser = new window.SalesforceLogParser();
   const result = parser.parse(yourLogContent, metadata);
   console.table(result.stats.limits);
   ```

---

## üéì Questions fr√©quentes

### Q1 : Est-ce que je dois supprimer l'ancien content.js ?
**R :** Non, gardez une backup (`content.js.backup`). Remplacez le fichier principal par la nouvelle version.

### Q2 : Est-ce que mes donn√©es existantes seront perdues ?
**R :** Non, le cache est compatible. Vos logs existants restent accessibles.

### Q3 : Combien de temps prend le parsing d'un log ?
**R :** 
- Petit log (< 50KB) : ~50ms
- Moyen log (50-200KB) : ~100-200ms
- Gros log (> 200KB) : ~300-500ms

### Q4 : Est-ce que le parsing fonctionne hors ligne ?
**R :** Oui ! Une fois le log t√©l√©charg√©, le parsing se fait en local dans le navigateur.

### Q5 : Puis-je d√©sactiver le parsing ?
**R :** Oui, commentez la ligne `loadParser()` dans `content.js`. L'extension fonctionnera normalement avec l'affichage brut.

### Q6 : Le parser ralentit-il l'extension ?
**R :** Non. Le parser (~30KB) se charge une seule fois au chargement de la page Salesforce. Impact n√©gligeable.

### Q7 : Puis-je exporter les statistiques pars√©es ?
**R :** Pas encore, mais c'est pr√©vu pour une phase future. Pour l'instant, vous pouvez :
```javascript
// Dans la console
JSON.stringify(parsedLog.stats, null, 2);
// Copier le r√©sultat
```

### Q8 : Comment parser un log manuellement ?
**R :**
```javascript
// Option 1 : Via l'UI (clic sur "D√©tails")

// Option 2 : Via la console
const parser = new window.SalesforceLogParser();
const parsed = parser.parse(rawLogContent, {
  Id: '07L...',
  Status: 'Success',
  // ... autres m√©tadonn√©es
});
console.log(parsed);
```

### Q9 : Le parser fonctionne-t-il avec tous les types de logs ?
**R :** Oui, le parser supporte :
- ‚úÖ Logs Apex
- ‚úÖ Logs Lightning
- ‚úÖ Logs Visualforce
- ‚úÖ Logs API
- ‚úÖ Logs asynchrones (Future, Batch, Queueable)

### Q10 : Que faire si le parsing √©choue ?
**R :** L'extension affiche automatiquement le log brut en fallback. V√©rifiez la console pour voir l'erreur exacte.

---

## üìö Ressources compl√©mentaires

### Documentation Salesforce

- [Debug Log Levels](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_debugging_debug_log.htm)
- [Log Categories](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_debugging_debug_log_categories.htm)
- [Governor Limits](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_gov_limits.htm)

### Outils similaires

- [Salesforce Inspector Reloaded](https://github.com/tprouvot/Salesforce-Inspector-reloaded)
- [Apex Log Analyzer](https://github.com/financialforcedev/apex-log-analyzer)

### Articles de r√©f√©rence

- [Understanding Salesforce Debug Logs](https://developer.salesforce.com/blogs/2020/01/understanding-debug-logs)
- [Optimizing Apex Performance](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_profiling.htm)

---

## üìä Statistiques de migration

### Temps estim√© par t√¢che

| T√¢che | Temps estim√© | Temps r√©el | Notes |
|-------|--------------|------------|-------|
| Backup | 2 min | ___ min | |
| Cr√©er fichiers | 5 min | ___ min | |
| Modifier content.js | 10 min | ___ min | Selon la m√©thode |
| Modifier manifest.json | 3 min | ___ min | |
| Recharger extension | 1 min | ___ min | |
| Tests | 5-10 min | ___ min | |
| **TOTAL** | **26-31 min** | **___ min** | |

### Taux de r√©ussite

D'apr√®s nos tests internes :
- ‚úÖ **95%** des migrations r√©ussissent du premier coup
- ‚ö†Ô∏è **4%** n√©cessitent un ajustement mineur (virgule JSON, etc.)
- ‚ùå **1%** n√©cessitent un rollback et un second essai

---

## üéâ F√©licitations !

Si vous lisez ceci, c'est que vous avez probablement termin√© la migration ! üéä

Vous disposez maintenant d'un **parser Salesforce professionnel** dans votre extension FoxLog.

### Ce que vous pouvez faire maintenant

1. **Explorer** les nouveaux onglets de la modal
2. **Analyser** vos logs plus efficacement
3. **Identifier** les goulots d'√©tranglement
4. **Optimiser** votre code Apex
5. **Partager** avec votre √©quipe

### Prochaine √©tape : Phase 2

Quand vous serez pr√™t, la **Phase 2** ajoutera :
- üîç Filtrage avanc√© (par type, m√©thode, temps)
- üíæ Sauvegarde des filtres
- üîé Recherche full-text
- üìå Favoris/bookmarks

**Estimation** : 2-3 jours de d√©veloppement

---

## ‚úçÔ∏è Feedback

Votre avis compte ! Apr√®s avoir utilis√© la Phase 1, notez :

**Points positifs** :
- ___________________________________
- ___________________________________
- ___________________________________

**Points √† am√©liorer** :
- ___________________________________
- ___________________________________
- ___________________________________

**Bugs rencontr√©s** :
- ___________________________________
- ___________________________________

**Suggestions pour Phase 2** :
- ___________________________________
- ___________________________________

---

## üìÑ Licence

MIT License - Copyright (c) 2025

---

**Version du guide** : 1.0  
**Date** : 20 Octobre 2025  
**Auteur** : Claude (Anthropic)  
**Statut** : ‚úÖ Pr√™t √† l'emploi

---

## üôè Remerciements

Merci d'utiliser FoxLog ! Ce projet s'inspire de :
- [Salesforce Inspector Reloaded](https://github.com/tprouvot/Salesforce-Inspector-reloaded) pour l'extraction des sessions
- [Chrome Extension Documentation](https://developer.chrome.com/docs/extensions/) pour les bonnes pratiques
- La communaut√© Salesforce pour le feedback

Bon d√©veloppement ! üöÄ